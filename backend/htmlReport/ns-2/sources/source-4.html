


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > CourseController</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">pt.uc.dei.controllers</a>
</div>

<h1>Coverage Summary for Class: CourseController (pt.uc.dei.controllers)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">CourseController</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    87.5%
  </span>
  <span class="absValue">
    (7/8)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    65.8%
  </span>
  <span class="absValue">
    (25/38)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    86.5%
  </span>
  <span class="absValue">
    (128/148)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package pt.uc.dei.controllers;
&nbsp;
&nbsp;import com.fasterxml.jackson.databind.ObjectMapper;
&nbsp;import jakarta.ejb.EJB;
&nbsp;import jakarta.validation.Valid;
&nbsp;import jakarta.ws.rs.*;
&nbsp;import jakarta.ws.rs.core.MediaType;
&nbsp;import jakarta.ws.rs.core.Response;
&nbsp;import jakarta.ws.rs.core.Context;
&nbsp;import jakarta.ws.rs.core.HttpHeaders;
&nbsp;import org.apache.logging.log4j.LogManager;
&nbsp;import org.apache.logging.log4j.Logger;
&nbsp;import org.jboss.resteasy.annotations.providers.multipart.MultipartForm;
&nbsp;import pt.uc.dei.annotations.AdminOnly;
&nbsp;import pt.uc.dei.config.IPLogger;
&nbsp;import pt.uc.dei.dtos.CourseUpdateDTO;
&nbsp;import pt.uc.dei.dtos.FileUploadDTO;
&nbsp;import pt.uc.dei.dtos.CourseNewDTO;
&nbsp;import pt.uc.dei.dtos.UpdateUserDTO;
&nbsp;import pt.uc.dei.dtos.CourseDTO;
&nbsp;import pt.uc.dei.enums.*;
&nbsp;import pt.uc.dei.services.CourseService;
&nbsp;import pt.uc.dei.services.CourseFileService;
&nbsp;import pt.uc.dei.utils.ApiResponse;
&nbsp;import pt.uc.dei.utils.JWTUtil;
&nbsp;
&nbsp;import java.io.InputStream;
&nbsp;import java.io.ByteArrayInputStream;
&nbsp;import java.io.ByteArrayOutputStream;
&nbsp;import java.io.IOException;
&nbsp;import java.nio.file.Files;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Date;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;import jakarta.ws.rs.core.EntityTag;
&nbsp;import jakarta.ws.rs.core.Request;
&nbsp;import jakarta.ws.rs.core.StreamingOutput;
&nbsp;import pt.uc.dei.utils.SearchUtils;
&nbsp;
&nbsp;/**
&nbsp; * REST Controller for managing course-related operations.
&nbsp; * &lt;p&gt;
&nbsp; * Provides endpoints for course retrieval and filtering functionality.
&nbsp; */
&nbsp;@Path(&quot;/courses&quot;)
<b class="fc">&nbsp;public class CourseController {</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Logger instance for logging operations within this controller.
&nbsp;     */
<b class="fc">&nbsp;    private static final IPLogger LOGGER = IPLogger.getLogger(CourseService.class);</b>
&nbsp;
&nbsp;
&nbsp;
&nbsp;    @EJB
&nbsp;    private CourseService courseService;
&nbsp;
&nbsp;    /**
&nbsp;     * Retrieves courses with filtering options.
&nbsp;     *
&nbsp;     * @param areaStr     Optional filter by course area
&nbsp;     * @param languageStr Optional filter by course language
&nbsp;     * @param adminName  Optional filter by admin name
&nbsp;     * @param courseIsActive Optional filter by active status
&nbsp;     * @param limit    Maximum number of results
&nbsp;     * @param offset   Starting position for pagination
&nbsp;     * @return Response with list of filtered course DTOs
&nbsp;     */
&nbsp;    @GET
&nbsp;    @Produces(MediaType.APPLICATION_JSON)
&nbsp;    @Consumes(MediaType.APPLICATION_JSON)
&nbsp;    public Response getCoursesWithFilters(
&nbsp;            @QueryParam(&quot;id&quot;) Long id,
&nbsp;            @QueryParam(&quot;title&quot;) String title,
&nbsp;            @QueryParam(&quot;duration&quot;) Integer duration,
&nbsp;            @QueryParam(&quot;description&quot;) String description,
&nbsp;            @QueryParam(&quot;area&quot;) String areaStr,
&nbsp;            @QueryParam(&quot;language&quot;) String languageStr,
&nbsp;            @QueryParam(&quot;adminName&quot;) String adminName,
&nbsp;            @QueryParam(&quot;courseIsActive&quot;) Boolean courseIsActive,
&nbsp;            @QueryParam(&quot;excludeCompletedByUserId&quot;) Long excludeCompletedByUserId,
&nbsp;            @QueryParam(&quot;excludeCourseIds&quot;) String excludeCourseIdsStr,
&nbsp;            @QueryParam(&quot;parameter&quot;) @DefaultValue(&quot;title&quot;) String parameterStr,
&nbsp;            @QueryParam(&quot;order&quot;) @DefaultValue(&quot;ASCENDING&quot;) String orderStr,
&nbsp;            @QueryParam(&quot;offset&quot;) @DefaultValue(&quot;0&quot;) Integer offset,
&nbsp;            @QueryParam(&quot;limit&quot;) @DefaultValue(&quot;10&quot;) Integer limit) {
<b class="pc">&nbsp;        Language language = languageStr != null ? Language.fromFieldName(languageStr) : null;</b>
<b class="pc">&nbsp;        CourseArea area = areaStr != null ? CourseArea.fromFieldName(SearchUtils.normalizeString(areaStr)) : null;</b>
<b class="fc">&nbsp;        CourseParameter parameter = CourseParameter.fromFieldName(SearchUtils.normalizeString(parameterStr));</b>
<b class="fc">&nbsp;        OrderBy orderBy = OrderBy.fromFieldName(SearchUtils.normalizeString(orderStr));</b>
&nbsp;        try {
<b class="fc">&nbsp;            LOGGER.debug(&quot;Retrieving courses with filters&quot;);</b>
&nbsp;            // Parse excludeCourseIdsStr (comma-separated) to List&lt;Long&gt;
<b class="fc">&nbsp;            List&lt;Long&gt; excludeCourseIds = new ArrayList&lt;&gt;();</b>
<b class="pc">&nbsp;            if (excludeCourseIdsStr != null &amp;&amp; !excludeCourseIdsStr.trim().isEmpty()) {</b>
<b class="nc">&nbsp;                for (String s : excludeCourseIdsStr.split(&quot;,&quot;)) {</b>
&nbsp;                    try {
<b class="nc">&nbsp;                        excludeCourseIds.add(Long.parseLong(s.trim()));</b>
&nbsp;                    } catch (NumberFormatException ignored) {}
&nbsp;                }
&nbsp;            }
<b class="fc">&nbsp;            Map&lt;String, Object&gt; courseData = courseService.getCoursesWithFilters(</b>
&nbsp;                    id, title, duration, description, area, language, adminName, courseIsActive,
&nbsp;                    parameter, orderBy, offset, limit, excludeCompletedByUserId, excludeCourseIds);
<b class="fc">&nbsp;            return Response.ok(new ApiResponse(true, &quot;Courses retrieved successfully&quot;, &quot;success&quot;, courseData))</b>
<b class="fc">&nbsp;                    .build();</b>
&nbsp;        } catch (Exception e) {
<b class="fc">&nbsp;            LOGGER.error(&quot;Unexpected error retrieving courses with filters&quot;, e);</b>
<b class="fc">&nbsp;            return Response.status(Response.Status.INTERNAL_SERVER_ERROR)</b>
<b class="fc">&nbsp;                    .entity(new ApiResponse(false, &quot;Internal server error&quot;, &quot;errorInternalServer&quot;, null))</b>
<b class="fc">&nbsp;                    .build();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Retrieves the image for a course by ID.
&nbsp;     *
&nbsp;     * @param id      Course ID.
&nbsp;     * @param request HTTP request context.
&nbsp;     * @param headers HTTP headers.
&nbsp;     * @return The course image or error response.
&nbsp;     */
&nbsp;    @GET
&nbsp;    @Path(&quot;/{id}/image&quot;)
&nbsp;    @Produces({ MediaType.APPLICATION_JSON, &quot;image/jpeg&quot;, &quot;image/png&quot;, &quot;image/webp&quot; })
&nbsp;    public Response getCourseImage(
&nbsp;            @PathParam(&quot;id&quot;) Long id,
&nbsp;            @Context Request request,
&nbsp;            @Context HttpHeaders headers) {
<b class="fc">&nbsp;        LOGGER.info(&quot;Course image retrieval request for course id: {}&quot;, id);</b>
&nbsp;        try {
<b class="fc">&nbsp;            java.nio.file.Path imagePath = CourseFileService.resolveCourseImagePath(id);</b>
<b class="fc">&nbsp;            if (imagePath == null) {</b>
<b class="fc">&nbsp;                LOGGER.warn(&quot;Image not found for course id: {}&quot;, id);</b>
<b class="fc">&nbsp;                return Response.status(Response.Status.NOT_FOUND)</b>
<b class="fc">&nbsp;                        .type(MediaType.APPLICATION_JSON)</b>
<b class="fc">&nbsp;                        .entity(new ApiResponse(false, &quot;Image not found&quot;, &quot;courseImageNotFound&quot;, null))</b>
<b class="fc">&nbsp;                        .build();</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            CourseFileService.CacheData cacheData = CourseFileService.getCacheData(imagePath);</b>
<b class="fc">&nbsp;            EntityTag etag = new EntityTag(cacheData.lastModified + &quot;-&quot; + cacheData.fileSize);</b>
&nbsp;
<b class="fc">&nbsp;            Response.ResponseBuilder builder = request.evaluatePreconditions(</b>
&nbsp;                    new Date(cacheData.lastModified),
&nbsp;                    etag);
&nbsp;
<b class="pc">&nbsp;            if (builder != null) {</b>
<b class="nc">&nbsp;                LOGGER.info(&quot;Course image not modified for course id: {}&quot;, id);</b>
<b class="nc">&nbsp;                return builder.build();</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            boolean acceptsJson = headers.getAcceptableMediaTypes().stream()</b>
<b class="fc">&nbsp;                    .anyMatch(m -&gt; m.isCompatible(MediaType.APPLICATION_JSON_TYPE));</b>
&nbsp;
<b class="fc">&nbsp;            StreamingOutput stream = output -&gt; {</b>
<b class="nc">&nbsp;                try (InputStream in = Files.newInputStream(imagePath)) {</b>
<b class="nc">&nbsp;                    in.transferTo(output);</b>
&nbsp;                } catch (IOException e) {
<b class="nc">&nbsp;                    LOGGER.error(&quot;Streaming error for course image of id: {}&quot;, id, e);</b>
<b class="nc">&nbsp;                    if (acceptsJson) {</b>
<b class="nc">&nbsp;                        output.write(new ObjectMapper().writeValueAsBytes(</b>
&nbsp;                                new ApiResponse(false, &quot;Stream error&quot;, &quot;streamError&quot;, null)));
&nbsp;                    }
&nbsp;                }
&nbsp;            };
<b class="fc">&nbsp;            LOGGER.info(&quot;Course image returned for course id: {}&quot;, id);</b>
<b class="fc">&nbsp;            return Response.ok(stream)</b>
<b class="fc">&nbsp;                    .type(cacheData.mimeType)</b>
<b class="fc">&nbsp;                    .header(&quot;Cache-Control&quot;, &quot;public, max-age=86400&quot;)</b>
<b class="fc">&nbsp;                    .header(&quot;ETag&quot;, etag.toString())</b>
<b class="fc">&nbsp;                    .lastModified(new Date(cacheData.lastModified))</b>
<b class="fc">&nbsp;                    .build();</b>
&nbsp;
&nbsp;        } catch (IOException e) {
<b class="nc">&nbsp;            LOGGER.error(&quot;Failed to load course image for id: {}&quot;, id, e);</b>
<b class="nc">&nbsp;            return Response.serverError()</b>
<b class="nc">&nbsp;                    .type(MediaType.APPLICATION_JSON)</b>
<b class="nc">&nbsp;                    .entity(new ApiResponse(false, &quot;Failed to load image&quot;, &quot;courseImageLoadError&quot;, null))</b>
<b class="nc">&nbsp;                    .build();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Uploads or updates a course&#39;s image.
&nbsp;     *
&nbsp;     * @param id   Course ID.
&nbsp;     * @param form Multipart form containing the image file.
&nbsp;     * @return HTTP 200 (OK) if uploaded, or error response.
&nbsp;     */
&nbsp;    @AdminOnly
&nbsp;    @PUT
&nbsp;    @Path(&quot;/{id}/image&quot;)
&nbsp;    @Consumes(MediaType.MULTIPART_FORM_DATA)
&nbsp;    @Produces(MediaType.APPLICATION_JSON)
&nbsp;    public Response uploadCourseImage(@PathParam(&quot;id&quot;) Long id, @MultipartForm FileUploadDTO form) {
<b class="fc">&nbsp;        LOGGER.info(&quot;Course image upload request for course id: {}&quot;, id);</b>
<b class="fc">&nbsp;        InputStream imageStream = form.getFileStream();</b>
<b class="fc">&nbsp;        ByteArrayOutputStream baos = new ByteArrayOutputStream();</b>
&nbsp;        try {
<b class="fc">&nbsp;            imageStream.transferTo(baos);</b>
&nbsp;        } catch (Exception e) {
<b class="fc">&nbsp;            LOGGER.error(&quot;Failed to read course image file for course id: {}&quot;, id, e);</b>
<b class="fc">&nbsp;            return Response.status(Response.Status.BAD_REQUEST)</b>
<b class="fc">&nbsp;                    .entity(new ApiResponse(false, &quot;Unsupported file type&quot;, &quot;errorInvalidType&quot;, null))</b>
<b class="fc">&nbsp;                    .build();</b>
&nbsp;        }
<b class="fc">&nbsp;        byte[] fileBytes = baos.toByteArray();</b>
<b class="fc">&nbsp;        InputStream forMimeType = new ByteArrayInputStream(fileBytes);</b>
<b class="fc">&nbsp;        InputStream forSaving = new ByteArrayInputStream(fileBytes);</b>
<b class="fc">&nbsp;        String filename = CourseFileService.getFilename(id, fileBytes);</b>
<b class="fc">&nbsp;        if (!CourseFileService.isValidMimeType(forMimeType)) {</b>
<b class="fc">&nbsp;            LOGGER.warn(&quot;Invalid mime type for course image upload by course id: {}&quot;, id);</b>
<b class="fc">&nbsp;            return Response.status(Response.Status.BAD_REQUEST)</b>
<b class="fc">&nbsp;                    .entity(new ApiResponse(false, &quot;Unsupported file type&quot;, &quot;errorInvalidType&quot;, null))</b>
<b class="fc">&nbsp;                    .build();</b>
&nbsp;        }
<b class="fc">&nbsp;        CourseFileService.removeExistingCourseImages(id);</b>
<b class="fc">&nbsp;        boolean saved = CourseFileService.saveFileWithSizeLimit(forSaving, filename);</b>
<b class="fc">&nbsp;        if (!saved) {</b>
<b class="fc">&nbsp;            LOGGER.warn(&quot;File too large for course image upload by course id: {}&quot;, id);</b>
<b class="fc">&nbsp;            return Response.status(Response.Status.BAD_REQUEST)</b>
<b class="fc">&nbsp;                    .entity(new ApiResponse(false, &quot;File too large&quot;, &quot;errorFileTooLarge&quot;, null))</b>
<b class="fc">&nbsp;                    .build();</b>
&nbsp;        }
<b class="fc">&nbsp;        CourseUpdateDTO courseUpdateDTO = new CourseUpdateDTO();</b>
<b class="fc">&nbsp;        courseUpdateDTO.setId(id);</b>
<b class="fc">&nbsp;        courseUpdateDTO.setCourseHasImage(true);</b>
<b class="fc">&nbsp;        courseService.updateCourse(courseUpdateDTO);</b>
<b class="fc">&nbsp;        LOGGER.info(&quot;Course image uploaded successfully for course id: {}&quot;, id);</b>
<b class="fc">&nbsp;        return Response.status(Response.Status.OK)</b>
<b class="fc">&nbsp;                .entity(new ApiResponse(true, &quot;File uploaded successfully&quot;, &quot;successFileUploaded&quot;, filename))</b>
<b class="fc">&nbsp;                .build();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Creates a new course. Only accessible by admins.
&nbsp;     *
&nbsp;     * @param jwtToken JWT token from cookie for admin authentication
&nbsp;     * @param dto      The new course data
&nbsp;     * @return Response indicating success or failure
&nbsp;     */
&nbsp;    @AdminOnly
&nbsp;    @POST
&nbsp;    @Consumes(MediaType.APPLICATION_JSON)
&nbsp;    @Produces(MediaType.APPLICATION_JSON)
&nbsp;    public Response createCourse(
&nbsp;            @CookieParam(&quot;jwt&quot;) String jwtToken,
&nbsp;            @Valid CourseNewDTO dto) {
<b class="fc">&nbsp;        LOGGER.info(&quot;Create course request received&quot;);</b>
&nbsp;        try {
<b class="fc">&nbsp;            if (!JWTUtil.isUserAdmin(jwtToken)) {</b>
<b class="fc">&nbsp;                LOGGER.warn(&quot;Unauthorized attempt to create course&quot;);</b>
<b class="fc">&nbsp;                return Response.status(Response.Status.FORBIDDEN)</b>
<b class="fc">&nbsp;                        .entity(new ApiResponse(false, &quot;Not authorized&quot;, &quot;notAuthorized&quot;, null))</b>
<b class="fc">&nbsp;                        .build();</b>
&nbsp;            }
<b class="fc">&nbsp;            Long adminId = JWTUtil.getUserIdFromToken(jwtToken);</b>
&nbsp;            try {
<b class="fc">&nbsp;                CourseDTO createdCourse = courseService.createNewCourse(dto, adminId);</b>
<b class="pc">&nbsp;                if (createdCourse != null) {</b>
<b class="fc">&nbsp;                    LOGGER.info(&quot;Course created successfully by admin id {}&quot;, adminId);</b>
<b class="fc">&nbsp;                    return Response.status(Response.Status.CREATED)</b>
<b class="fc">&nbsp;                            .entity(new ApiResponse(true, &quot;Course created successfully&quot;, &quot;successCourseCreated&quot;, createdCourse))</b>
<b class="fc">&nbsp;                            .build();</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    LOGGER.warn(&quot;Failed to create course (admin not found)&quot;);</b>
<b class="nc">&nbsp;                    return Response.status(Response.Status.BAD_REQUEST)</b>
<b class="nc">&nbsp;                            .entity(new ApiResponse(false, &quot;Course not created (admin not found)&quot;, &quot;errorCourseNotCreated&quot;, null))</b>
<b class="nc">&nbsp;                            .build();</b>
&nbsp;                }
&nbsp;            } catch (IllegalArgumentException ex) {
<b class="fc">&nbsp;                String errorCode = ex.getMessage();</b>
&nbsp;                String errorMsg;
<b class="fc">&nbsp;                if (&quot;duplicateTitle&quot;.equals(errorCode)) {</b>
<b class="fc">&nbsp;                    errorMsg = &quot;Course with this title already exists&quot;;</b>
<b class="pc">&nbsp;                } else if (&quot;duplicateLink&quot;.equals(errorCode)) {</b>
<b class="fc">&nbsp;                    errorMsg = &quot;Course with this link already exists&quot;;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    errorMsg = &quot;Course not created (duplicate title or link)&quot;;</b>
&nbsp;                }
<b class="fc">&nbsp;                LOGGER.warn(&quot;Failed to create course: {}&quot;, errorMsg);</b>
<b class="fc">&nbsp;                return Response.status(Response.Status.BAD_REQUEST)</b>
<b class="fc">&nbsp;                        .entity(new ApiResponse(false, errorMsg, errorCode, null))</b>
<b class="fc">&nbsp;                        .build();</b>
&nbsp;            }
&nbsp;        } catch (Exception e) {
<b class="fc">&nbsp;            LOGGER.error(&quot;Unexpected error creating course&quot;, e);</b>
<b class="fc">&nbsp;            return Response.status(Response.Status.INTERNAL_SERVER_ERROR)</b>
<b class="fc">&nbsp;                    .entity(new ApiResponse(false, &quot;Internal server error&quot;, &quot;errorInternalServer&quot;, null))</b>
<b class="fc">&nbsp;                    .build();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Updates an existing course. Only accessible by admins.
&nbsp;     *
&nbsp;     * @param jwtToken JWT token from cookie for admin authentication
&nbsp;     * @param id       The id of the course to update
&nbsp;     * @param dto      The updated course data (fields are optional)
&nbsp;     * @return Response indicating success or failure
&nbsp;     */
&nbsp;    @AdminOnly
&nbsp;    @PUT
&nbsp;    @Path(&quot;/{id}&quot;)
&nbsp;    @Consumes(MediaType.APPLICATION_JSON)
&nbsp;    @Produces(MediaType.APPLICATION_JSON)
&nbsp;    public Response updateCourse(
&nbsp;            @CookieParam(&quot;jwt&quot;) String jwtToken,
&nbsp;            @PathParam(&quot;id&quot;) Long id,
&nbsp;            @Valid CourseUpdateDTO dto) {
<b class="fc">&nbsp;        LOGGER.info(&quot;Update course request received for id {}&quot;, id);</b>
&nbsp;        try {
<b class="fc">&nbsp;            if (!JWTUtil.isUserAdmin(jwtToken)) {</b>
<b class="fc">&nbsp;                LOGGER.warn(&quot;Unauthorized attempt to update course&quot;);</b>
<b class="fc">&nbsp;                return Response.status(Response.Status.FORBIDDEN)</b>
<b class="fc">&nbsp;                        .entity(new ApiResponse(false, &quot;Not authorized&quot;, &quot;notAuthorized&quot;, null))</b>
<b class="fc">&nbsp;                        .build();</b>
&nbsp;            }
<b class="fc">&nbsp;            if (dto == null) {</b>
<b class="fc">&nbsp;                return Response.status(Response.Status.BAD_REQUEST)</b>
<b class="fc">&nbsp;                        .entity(new ApiResponse(false, &quot;Missing course data&quot;, &quot;missingCourseData&quot;, null))</b>
<b class="fc">&nbsp;                        .build();</b>
&nbsp;            }
<b class="fc">&nbsp;            dto.setId(id); // Ensure path id is used</b>
&nbsp;            try {
<b class="fc">&nbsp;                boolean updated = courseService.updateCourse(dto);</b>
<b class="fc">&nbsp;                if (updated) {</b>
<b class="fc">&nbsp;                    LOGGER.info(&quot;Course updated successfully for id {}&quot;, id);</b>
<b class="fc">&nbsp;                    return Response.ok(new ApiResponse(true, &quot;Course updated successfully&quot;, &quot;successCourseUpdated&quot;, null)).build();</b>
&nbsp;                } else {
<b class="fc">&nbsp;                    LOGGER.warn(&quot;Failed to update course with id {}&quot;, id);</b>
<b class="fc">&nbsp;                    return Response.status(Response.Status.NOT_FOUND)</b>
<b class="fc">&nbsp;                            .entity(new ApiResponse(false, &quot;Course not found&quot;, &quot;courseNotFound&quot;, null))</b>
<b class="fc">&nbsp;                            .build();</b>
&nbsp;                }
&nbsp;            } catch (IllegalArgumentException ex) {
<b class="fc">&nbsp;                String errorCode = ex.getMessage();</b>
&nbsp;                String errorMsg;
<b class="fc">&nbsp;                if (&quot;duplicateTitle&quot;.equals(errorCode)) {</b>
<b class="fc">&nbsp;                    errorMsg = &quot;Course with this title already exists&quot;;</b>
<b class="pc">&nbsp;                } else if (&quot;duplicateLink&quot;.equals(errorCode)) {</b>
<b class="fc">&nbsp;                    errorMsg = &quot;Course with this link already exists&quot;;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    errorMsg = &quot;Course not created (duplicate title or link)&quot;;</b>
&nbsp;                }
<b class="fc">&nbsp;                LOGGER.warn(&quot;Failed to create course: {}&quot;, errorMsg);</b>
<b class="fc">&nbsp;                return Response.status(Response.Status.BAD_REQUEST)</b>
<b class="fc">&nbsp;                        .entity(new ApiResponse(false, errorMsg, errorCode, null))</b>
<b class="fc">&nbsp;                        .build();</b>
&nbsp;            }
&nbsp;        } catch (Exception e) {
<b class="fc">&nbsp;            LOGGER.error(&quot;Unexpected error updating course&quot;, e);</b>
<b class="fc">&nbsp;            return Response.status(Response.Status.INTERNAL_SERVER_ERROR)</b>
<b class="fc">&nbsp;                    .entity(new ApiResponse(false, &quot;Internal server error&quot;, &quot;errorInternalServer&quot;, null))</b>
<b class="fc">&nbsp;                    .build();</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-07-15 20:29</div>
</div>
</body>
</html>
